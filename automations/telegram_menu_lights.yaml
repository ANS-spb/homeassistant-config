###################################
#     –ú–µ–Ω—é –≤ Telegram: –°–≤–µ—Ç       #
###################################

- alias: Telegram Menu Lights
  id: telefram_menu_lights
  description: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º —á–µ—Ä–µ–∑ Telegram"

  trigger:
    - platform: event
      event_type: telegram_callback
      event_data: {}

  action:
    - choose:
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/lights" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: –ß—Ç–æ –í—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å —Å–æ —Å–≤–µ—Ç–æ–º?
            - service: telegram_bot.edit_message
              data:
                message_id: last
                chat_id: "{{ trigger.event.data.chat_id }}"
                message: &msg |
                  {%if states.light | selectattr('entity_id') |
                  selectattr('state','eq','on') | map(attribute='entity_id') | list | count == 0 %}*–°–≤–µ—Ç* –≤–µ–∑–¥–µ –≤—ã–∫–ª—é—á–µ–Ω.
                  {% else %}*–°–≤–µ—Ç* –≤–∫–ª—é—á–µ–Ω: {{ states.light | selectattr("state", "eq", "on") |
                  map(attribute  = "name") | join(", ") }}.{% endif %}
                inline_keyboard: &keyb
                  - –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç –≤ –∫–æ–º–Ω–∞—Ç–µ:/lighton
                  - '{% if is_state("light.prikhozhaia", "off")%}{{"üî¥"}}{%else %}{{"üü¢"}}{% endif %} –ü—Ä–∏—Ö–æ–∂–∞—è:/lobby_toggle,
                    {% if is_state("light.kukhnia_hue", "off") %}{{"üî¥"}}{% else %}{{"üü¢"}}{%endif %} –ö—É—Ö–Ω—è:/kitchen_toggle'
                  - '{% if is_state("light.torsher_2", "off") %}{{"üî¥"}}{%else %}{{"üü¢"}}{% endif %} –¢–æ—Ä—à–µ—Ä:/torsher_toggle,
                    {% if is_state("light.torsherchik", "off") %}{{"üî¥"}}{%else %}{{"üü¢"}}{% endif %} –ù–∞—Å—Ç–æ–ª—å–Ω–∞—è:/torsherchik_toggle'
                  - '{% if is_state("light.living_room", "off") %}{{"üî¥"}}{%else %}{{"üü¢"}}{% endif %} –õ–∞–º–ø–∞:/living_toggle,
                    {% if is_state("light.liustra", "off") %}{{"üî¥"}}{% else %}{{"üü¢"}}{%endif %} –õ—é—Å—Ç—Ä–∞:/liustra_toggle'
                  - –í—ã–∫–ª—é—á–∏—Ç—å –í–°√ã:/lightoff
                  - –ù–∞–∑–∞–¥:/back
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/lighton" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: "–í–∫–ª—é—á–∞—é –æ–±—ã—á–Ω—ã–π —Å–≤–µ—Ç :)"
            - service: script.1599944056170
              data: {}
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/lobby_toggle" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: –ü–µ—Ä–µ–∫–ª—é—á–∞—é —Å–≤–µ—Ç –≤ –ø—Ä–∏—Ö–æ–∂–µ–π.
            - service: light.toggle
              target:
                entity_id: light.prikhozhaia
            - delay:
                milliseconds: 500
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/kitchen_toggle" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: '{% if is_state("light.kukhnia_hue", "off")%}{{"–í–∫–ª—é—á–∞—é —Å–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ."}}{%else %}{{"–í—ã–∫–ª—é—á–∞—é —Å–≤–µ—Ç –Ω–∞ –∫—É—Ö–Ω–µ."}}{% endif %}'
            - service: light.toggle
              target:
                entity_id: light.kukhnia_hue
            - delay:
                milliseconds: 500
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/torsher_toggle" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: '{% if is_state("light.torsher_2", "off")%}{{"–í–∫–ª—é—á–∞—é —Ç–æ—Ä—à–µ—Ä –≤ —Å–ø–∞–ª—å–Ω–µ."}}{%else %}{{"–í—ã–∫–ª—é—á–∞—é —Ç–æ—Ä—à–µ—Ä –≤ —Å–ø–∞–ª—å–Ω–µ."}}{% endif %}'
            - service: light.toggle
              target:
                entity_id: light.torsher
            - delay:
                milliseconds: 500
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/torsherchik_toggle" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: '{% if is_state("light.torsherchik", "off")%}{{"–í–∫–ª—é—á–∞—é –Ω–∞—Å—Ç–æ–ª—å–Ω—É—é –ª–∞–º–ø—É."}}{%else %}{{"–í—ã–∫–ª—é—á–∞—é –Ω–∞—Å—Ç–æ–ª—å–Ω—É—é –ª–∞–º–ø—É."}}{% endif %}'
            - service: light.toggle
              target:
                entity_id: light.torsherchik
            - delay:
                milliseconds: 500
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/living_toggle" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: '{% if is_state("light.living_room", "off")%}{{"–í–∫–ª—é—á–∞—é –ª–∞–º–ø—É –≤ —Å–ø–∞–ª—å–Ω–µ."}}{%else %}{{"–í—ã–∫–ª—é—á–∞—é –ª–∞–º–ø—É –≤ —Å–ø–∞–ª—å–Ω–µ."}}{% endif %}'
            - service: light.toggle
              target:
                entity_id: light.living_room
            - delay:
                milliseconds: 500
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/liustra_toggle" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: '{% if is_state("light.liustra", "off")%}{{"–í–∫–ª—é—á–∞—é –ª—é—Å—Ç—Ä—É –≤ —Å–ø–∞–ª—å–Ω–µ."}}{%else %}{{"–í—ã–∫–ª—é—á–∞—é –ª—é—Å—Ç—Ä—É –≤ —Å–ø–∞–ª—å–Ω–µ."}}{% endif %}'
            - service: light.toggle
              target:
                entity_id: light.liustra
            - delay:
                milliseconds: 500
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
        - conditions:
            - condition: template
              value_template: '{{ trigger.event.data.command == "/lightoff" }}'
          sequence:
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: –í—ã–∫–ª—é—á–∞—é –≤–µ—Å—å —Å–≤–µ—Ç!
            - service: script.1644819849093
              data: {}
            - delay:
                milliseconds: 2000
            - service: telegram_bot.edit_message
              data:
                message_id: "{{ trigger.event.data.message.message_id }}"
                chat_id: "{{ trigger.event.data.chat_id }}"
                callback_query_id: "{{ trigger.event.data.id }}"
                message: *msg
                inline_keyboard: *keyb
      default: []

  mode: queued
