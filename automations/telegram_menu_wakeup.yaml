#######################################
#     –ú–µ–Ω—é –≤ Telegram: –ë—É–¥–∏–ª—å–Ω–∏–∫      #
#######################################

- alias: Telegram Menu Wakeup
  id: telegram_menu_wakeup
  description: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—É–¥–∏–ª—å–Ω–∏–∫–∞"
  trigger:
    - platform: event
      event_type: telegram_callback
      event_data:
        data: /wakeup
  action:
    - service: telegram_bot.answer_callback_query
      data_template:
        callback_query_id: "{{ trigger.event.data.id }}"
        message: –ë—É–¥–∏–ª—å–Ω–∏–∫
    - service: telegram_bot.edit_message
      data_template:
        message_id: last
        chat_id: "{{ trigger.event.data.chat_id }}"
        message: &msg |-
          –ë—É–¥–∏–ª—å–Ω–∏–∫
          {%- if is_state('input_boolean.wakeup_enabled','on') %} 
            {%- if is_state('input_boolean.wakeup_disabled','off') %} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞
              {%- if is_state('input_select.wakeup_time','–ú–µ—Ç—Ä–æ') %} {{ state_attr('input_datetime.wakeup_office_time', 'timestamp') | timestamp_custom('%H:%M', false) }}.
              {%- elif is_state('input_select.wakeup_time','–ú–∞—à–∏–Ω–∞') %} {{ state_attr('input_datetime.wakeup_office_car_time', 'timestamp') | timestamp_custom('%H:%M', false) }}.
              {%- elif is_state('input_select.wakeup_time','–°–∏–¥–∏–º –¥–æ–º–∞') %} {{ state_attr('input_datetime.wakeup_homeoffice_time', 'timestamp') | timestamp_custom('%H:%M', false) }}.
              {%- endif -%}
            {%- elif is_state('input_boolean.wakeup_weekend','on') and is_state('input_boolean.wakeup_disabled','on') %} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ {{ state_attr('input_datetime.wakeup_weekend_time', 'timestamp') | timestamp_custom('%H:%M', false) }}
            {%- else %} –≤—ã–∫–ª—é—á–µ–Ω.
            {%- endif -%}
          {%- else %} –≤—ã–∫–ª—é—á–µ–Ω.
          {%- endif %}
        inline_keyboard: &keyb
          - üöá –ï–¥–µ–º –Ω–∞ –º–µ—Ç—Ä–æ:/wakeup_office_time
          - üöò –ü—Ä–∏—Ü–µ–ø–æ–º –Ω–∞ –º–∞—à–∏–Ω–µ:/wakeup_office_car_time
          - üè† –ß–∏–ª–∏–º –¥–æ–º–∞:/wakeup_homeoffice_time
          - ‚è∞ {% if is_state('input_boolean.wakeup_enabled', 'on')%}{{'–í—ã–∫–ª—é—á–∏—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫ üö´'}}{% else %}{{'–í–∫–ª—é—á–∏—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫ ‚úÖ'}}{% endif %}:/wakeup_toggle
          - üîô –ù–∞–∑–∞–¥:/back
  mode: single

- alias: Telegram Menu Wakeup Set Time
  id: telegram_menu_wakeup_set_time
  description: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—É–¥–∏–ª—å–Ω–∏–∫–∞"
  trigger:
    - id: wakeup_office_time
      platform: event
      event_type: telegram_callback
      event_data:
        data: /wakeup_office_time
    - id: wakeup_office_car_time
      platform: event
      event_type: telegram_callback
      event_data:
        data: /wakeup_office_car_time
    - id: wakeup_homeoffice_time
      platform: event
      event_type: telegram_callback
      event_data:
        data: /wakeup_homeoffice_time
    - id: wakeup_toggle
      platform: event
      event_type: telegram_callback
      event_data:
        data: /wakeup_toggle
  action:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - wakeup_office_time
          sequence:
            - service: input_select.select_option
              target:
                entity_id: input_select.wakeup_time
              data:
                option: '–ú–µ—Ç—Ä–æ'
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: –ò–∑–º–µ–Ω–µ–Ω–æ
        - conditions:
            - condition: trigger
              id:
                - wakeup_office_car_time
          sequence:
            - service: input_select.select_option
              target:
                entity_id: input_select.wakeup_time
              data:
                option: '–ú–∞—à–∏–Ω–∞'
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: –ò–∑–º–µ–Ω–µ–Ω–æ
        - conditions:
            - condition: trigger
              id:
                - wakeup_homeoffice_time
          sequence:
            - service: input_select.select_option
              target:
                entity_id: input_select.wakeup_time
              data:
                option: '–°–∏–¥–∏–º –¥–æ–º–∞'
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: –ò–∑–º–µ–Ω–µ–Ω–æ
        - conditions:
            - condition: trigger
              id:
                - wakeup_toggle
          sequence:
            - service: input_boolean.toggle
              target:
                entity_id: input_boolean.wakeup_enabled
            - service: telegram_bot.answer_callback_query
              data_template:
                callback_query_id: "{{ trigger.event.data.id }}"
                message: –ò–∑–º–µ–Ω–µ–Ω–æ
    - service: telegram_bot.edit_message
      data:
        message_id: "{{ trigger.event.data.message.message_id }}"
        chat_id: "{{ trigger.event.data.chat_id }}"
        callback_query_id: "{{ trigger.event.data.id }}"
        message: *msg
        inline_keyboard: *keyb
