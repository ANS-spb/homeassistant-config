#######################################
#      –ú–µ–Ω—é –≤ Telegram: –î–∞—Ç—á–∏–∫–∏       #
#######################################

- alias: Telegram Menu Sensors
  id: telegram_menu_sensors
  description: "–°—Ç–∞—Ç—É—Å –¥–∞—Ç—á–∏–∫–æ–≤ –∏ —Å–≤–µ—Ç–∞"

  trigger:
    - platform: event
      event_type: telegram_callback
      event_data:
        data: /status

  action:
    - service: telegram_bot.answer_callback_query
      data_template:
        callback_query_id: "{{ trigger.event.data.id }}"
        message: –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –¥–∞—Ç—á–∏–∫–æ–≤
    - service: script.dynamic_update_all_light_group
      data: {}
    - service: telegram_bot.edit_message
      data_template:
        message_id: last
        chat_id: "{{ trigger.event.data.chat_id }}"
        message: |-
          *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –∫–æ–º–Ω–∞—Ç–µ* {{states('sensor.ble_datchik_v_spalne_temperature')|round(0)|format(morph='–≥—Ä–∞–¥—É—Å',as_text=false)}}
          *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞ –∫—É—Ö–Ω–µ* {{states('sensor.ble_temperature_datchik_na_kukhne')|round(0)|format(morph='–≥—Ä–∞–¥—É—Å',as_text=false)}}
          *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞ –ª–æ–¥–∂–∏–∏* {{states('sensor.lodzhiia_temperature')|round(0)|format(morph='–≥—Ä–∞–¥—É—Å',as_text=false)}}
          *–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞ —É–ª–∏—Ü–µ* {{states('sensor.ulitsa_temperature')|round(0)|format(morph='–≥—Ä–∞–¥—É—Å',as_text=false)}}

          *–í–ª–∞–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–Ω–∞—Ç–µ* {{states('sensor.ble_datchik_v_spalne_humidity')|round(0)}}%
          *–í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–∞ –∫—É—Ö–Ω–µ* {{states('sensor.ble_humidity_datchik_na_kukhne')|round(0)}}%
          *–í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–∞ –ª–æ–¥–∂–∏–∏* {{states('sensor.lodzhiia_humidity')|round(0)}}%
          *–í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–∞ —É–ª–∏—Ü–µ* {{states('sensor.ulitsa_humidity')|round(0)}}%

          *–£—Ä–æ–≤–µ–Ω—å CO2* {{states('sensor.co2_sensor_air_monitor_lite')|round(0)}}% ppm
          
          {% if is_state("binary_sensor.okno_v_komnate_contact", "off")%}
          –û–∫–Ω–æ –≤ —Å–ø–∞–ª—å–Ω–µ –∑–∞–∫—Ä—ã—Ç–æ. {% else %} *–û–∫–Ω–æ –≤ —Å–ø–∞–ª—å–Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ!* {% endif %}
          {% if is_state("binary_sensor.okno_na_kukhne_contact", "off")%}
          –û–∫–Ω–æ –Ω–∞ –∫—É—Ö–Ω–µ –∑–∞–∫—Ä—ã—Ç–æ. {% else %}*–û–∫–Ω–æ –Ω–∞ –∫—É—Ö–Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ!* {% endif %}
          {%if states.light | selectattr('entity_id') |
          selectattr('state','eq','on') | map(attribute='entity_id') | list | count == 0 %}
          *–°–≤–µ—Ç* –≤–µ–∑–¥–µ –≤—ã–∫–ª—é—á–µ–Ω.
          {% else %}
          *–°–≤–µ—Ç* –≤–∫–ª—é—á–µ–Ω: {{ states.light | selectattr("state", "eq", "on") 
          | map(attribute  = "name") | join(", ") }}.
          {% endif %}
        inline_keyboard:
          - üîô –ù–∞–∑–∞–¥:/back

  mode: single