####################################
# ÐŸÑ‹Ð»ÐµÑÐ¾Ñ: Ð¾Ð¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ñ Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ #
####################################

- alias: "Vacuum - ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ðµ ÑƒÐ±Ð¾Ñ€ÐºÐ¸"
  id: vacuum_telegram_begin_info
  initial_state: true
  trigger:
    platform: state
    entity_id: vacuum.roborock_s6_pure
    to: "cleaning"
    not_from: "unavailable"
  action:
    - service: telegram_bot.send_message
      data:
        target: !secret telegram_bot_allowed_chat_id1
        message: "_Ð”Ñ€ÑƒÐ¶Ð¾Ñ‡ÐµÐº_ Ð½Ð°Ñ‡Ð°Ð» ÑƒÐ±Ð¾Ñ€ÐºÑƒ."
        inline_keyboard:
          - "ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ:/vacuum_stop, âŽ ÐÐ° Ð±Ð°Ð·Ñƒ:/vacuum_go_home"

- alias: "Vacuum - Telegram Control - Stop"
  id: vacuum_telegram_stop
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: "/vacuum_stop"
  action:
    - service: vacuum.pause
      entity_id: vacuum.roborock_s6_pure
    - service: telegram_bot.answer_callback_query
      data_template:
        callback_query_id: "{{ trigger.event.data.id }}"
        message: "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð°"
    - service: telegram_bot.edit_message
      data:
        message_id: "{{ trigger.event.data.message.message_id }}"
        chat_id: "{{ trigger.event.data.chat_id }}"
        message: |
          _Ð”Ñ€ÑƒÐ¶Ð¾Ñ‡ÐµÐº_ Ð½Ð°Ñ‡Ð°Ð» ÑƒÐ±Ð¾Ñ€ÐºÑƒ.
          Ð£Ð±Ð¾Ñ€ÐºÐ° Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°.
        inline_keyboard:
          - "âŽ ÐÐ° Ð±Ð°Ð·Ñƒ:/vacuum_go_home"

- alias: "Vacuum - Telegram Control - Go to Base"
  id: vacuum_tetegram_to_return
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: "/vacuum_go_home"
  action:
    - service: vacuum.pause
      entity_id: vacuum.roborock_s6_pure
    - delay: 1
    - service: vacuum.return_to_base
      entity_id: vacuum.roborock_s6_pure
    - service: telegram_bot.answer_callback_query
      data_template:
        callback_query_id: "{{ trigger.event.data.id }}"
        message: "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð°"
    - service: telegram_bot.edit_message
      data:
        message_id: "{{ trigger.event.data.message.message_id }}"
        chat_id: "{{ trigger.event.data.chat_id }}"
        message: |
          _Ð”Ñ€ÑƒÐ¶Ð¾Ñ‡ÐµÐº_ Ð½Ð°Ñ‡Ð°Ð» ÑƒÐ±Ð¾Ñ€ÐºÑƒ.
          Ð£Ð±Ð¾Ñ€ÐºÐ° Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°, Ñ€Ð¾Ð±Ð¾Ñ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ð½Ð° Ð±Ð°Ð·Ñƒ.

- alias: "Vacuum - ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ð¿Ñ‹Ð»ÐµÑÐ¾ÑÐ° [notify]"
  id: vacuum_telegram_returning_info
  initial_state: true
  trigger:
    platform: state
    entity_id: vacuum.roborock_s6_pure
    to: "returning"
    not_from: "unavailable"
  action:
    - service: notify.telegram
      data:
        message: "_Ð”Ñ€ÑƒÐ¶Ð¾Ñ‡ÐµÐº_ Ð½Ð° Ð¿ÑƒÑ‚Ð¸ Ð´Ð¾Ð¼Ð¾Ð¹."

- alias: "Vacuum - ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ð¿Ñ‹Ð»ÐµÑÐ¾ÑÐ° Ð½Ð° Ð±Ð°Ð·Ñƒ [notify]"
  id: vacuum_telegram_returned_info
  initial_state: true
  trigger:
    platform: state
    entity_id: vacuum.roborock_s6_pure
    to: "docked"
    not_from: "unavailable"
  action:
    - service: notify.telegram
      data:
        message: "_Ð”Ñ€ÑƒÐ¶Ð¾Ñ‡ÐµÐº_ Ð²ÐµÑ€Ð½ÑƒÐ»ÑÑ Ð½Ð° Ð±Ð°Ð·Ñƒ (Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð» ÑƒÐ±Ð¾Ñ€ÐºÑƒ)."

- alias: "Vacuum - ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð·Ð°Ð±Ñ‹Ñ‚Ð¾Ð¼ Ð¿Ñ‹Ð»ÐµÑÐ¾ÑÐµ [notify]"
  id: vacuum_telegram_lost_info
  initial_state: true
  trigger:
    platform: state
    entity_id: vacuum.roborock_s6_pure
    to: "idle"
    for:
      minutes: 15
  action:
    - service: notify.telegram
      data:
        message: "_Ð”Ñ€ÑƒÐ¶Ð¾Ñ‡ÐµÐº_ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ»ÑÑ Ð¸ Ð±ÐµÐ·Ð´ÐµÐ»ÑŒÐ½Ð¸Ñ‡Ð°ÐµÑ‚, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð° Ð±Ð°Ð·Ñƒ."
    - service: vacuum.return_to_base
      data:
        entity_id: vacuum.roborock_s6_pure

- alias: "Vacuum - ÐžÐ¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ [notify]"
  id: vacuum_telegram_error_info
  initial_state: true
  trigger:
    platform: state
    entity_id: vacuum.roborock_s6_pure
    to: "error"
    not_from: "unavailable"
  action:
    - service: notify.telegram
      data_template:
        message: |
          _Ð”Ñ€ÑƒÐ¶Ð¾Ñ‡ÐµÐº_: ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° *Ð¾ÑˆÐ¸Ð±ÐºÐ°*!
          {{ state_attr('vacuum.roborock_s6_pure', "error") }}

- alias: "Vacuum - Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð°Ñ ÑƒÐ±Ð¾Ñ€ÐºÐ° Ð¿Ð¾ Ð±ÑƒÐ´Ð½ÑÐ¼ [ÑƒÑ‚Ñ€Ð¾]"
  id: vacuum_automation_workday_cleaning
  initial_state: true
  trigger:
    platform: state
    entity_id: group.devices
    to: "not_home"
    for:
      minutes: 20
  condition:
    condition: and
    conditions:
      - condition: time
        after: "07:30:00"
        before: "10:30:00"
#        weekday:
#          - mon
#          - tue
#          - wed
#          - thu
#          - fri
      - condition: state
        entity_id: binary_sensor.workday
        state: "on"
      - condition: template
        value_template: "{{ now().day != this.attributes.last_triggered.day | default(0) }}"
  action:
    - if:
        - condition: template
          value_template:  >-
            {{ state_attr('cover.shtora', 'current_position') < 100}}
      then:
        - service: cover.open_cover
          target:
            entity_id: cover.shtora
        - wait_template: >-
            {{ state_attr('cover.shtora', 'current_position') == 100}}
          continue_on_timeout: false
          timeout: "00:00:30"
    - service: vacuum.set_fan_speed
      data:
        entity_id: vacuum.roborock_s6_pure
        fan_speed: Turbo
    - service: vacuum.start
      data:
        entity_id: vacuum.roborock_s6_pure
